<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
	  <th:block th:include="fragments/headerlibs.html :: headerlibs"></th:block> 
      <style>
			html{
				overflow-x: hidden;
			}
			#login .container #login-row #login-column #login-box {
  				margin: 0 auto;
				height: auto;
				border: 1px solid #3e7205;
				background-color: #f7f7f7;
				color:#3e7205;
			}
			#login .container #login-row #login-column #login-box #login-form {
				padding: 20px;
			}
			.login-form-padding{
				padding: 20px;
			}
			
			#login .container #login-row #login-column #login-box #login-form #register-link {
				margin-top: -85px;
			}
			
			.captcha-refresh-btn{
				padding: 0;
    			position: relative;
    			top: 10px;
			}
		</style>	
	</head>
	<body>
	<header th:insert="fragments/header.html :: header"> </header>
			<div class="container">
				<div class="row">
						<div id="login">
								<h3 class="text-center">&nbsp;</h3>
								<div class="container">
									<div id="login-row" class="justify-content-center align-items-center">
										<div id="login-column" style="width: 80%; margin:0 auto; display:block;">
											<div id="login-box" >
										
												<form id="register-form" class="form form-horizontal login-form-padding" th:action="@{/applicantregistrationmethod}" th:object="${applicantregistration}" data-toggle="validator" enctype="multipart/form-data" method="post">
													<h3 class="text-center"><b>Applicant Registration</b></h3><br>
													<div class="form-group">
														<label class="col-md-3 control-label">Applicant Type<span style="color:red">*</span></label>
														<div class="col-md-9">
														<div  th:if="${applicantrolelist != null}">
															<select th:field="*{applicanttype}" id="ddlapplicant"  class="form-control">
																<option th:value="null">Select</option>
																 <option th:each="applicant : ${applicantrolelist}"
														               th:value="${applicant[0]}"
														               th:text="${applicant[1]}" />
															</select>
															<div class="alert alert-danger" th:if="${#fields.hasErrors('applicanttype')}" th:errors="*{applicanttype}"></div>
														</div>
														</div>
														
													</div>
													
													<div id="dvCompany" style="display: none">
													<div class="form-group">
														<label class="col-md-3 control-label">Company Name<span style="color:red">*</span></label>
														<div class="col-md-9">
															<div  th:if="${companyregistration != null}">
															<select th:field="*{companyid}"  class="form-control">
																<option th:value="null" >Select</option>
														            <option th:each="company : ${companyregistration}"
														               th:value="${company[0]}"
														               th:text="${company[1]}" />
																
															</select>
															</div>
														</div>
														
														
													</div>
													</div>
													<div id="dvInstitution" style="display: none">
													<div class="form-group">
														<label class="col-md-3 control-label">Institution Name<span style="color:red">*</span></label>
														<div class="col-md-9">
															
															<div  th:if="${institutionregistration != null}">
															<select th:field="*{institutionid}"  class="form-control">
																<option th:value="null" >Select</option>
														            <option th:each="institution : ${institutionregistration}"
														               th:value="${institution[0]}"
														               th:text="${institution[1]}" />
																
															</select>
															</div>
															
														</div>
													</div>
													</div>
													
													 <div id="dvOther" style="display: none">
													<div class="form-group">
														<label class="col-md-3 control-label">Company/Institution Name (If Type is Other)<span style="color:red">*</span></label>
														<div class="col-md-9">
															<input type="text" name="other" id="other" onblur='javascript:institutenamecheck(),companycheck()'class="form-control">
														  	<div class="help-block with-errors" id="othererror"></div>
														</div>
													</div>
													</div>
													
													 <div class="form-group">
														<label class="col-md-3 control-label">Name<span style="color:red">*</span></label>
														<div class="col-md-9"> 
														
																<input type="text" id="authorname" th:field="*{firstname}" name="firstname" onblur='javascript:authornamecheck()'class="form-control">
																<div class="alert alert-danger" th:if="${#fields.hasErrors('firstname')}" th:errors="*{firstname}"></div>
														<div class="help-block with-errors" id="authornameerror"></div>
														</div>
													</div>
													<div class="form-group">
														<label class="col-md-3 control-label">User Name<span style="color:red">*</span></label>
														<div class="col-md-9">
														
															<input type="text" th:field="*{username}" id="username" name="username" onblur='javascript:usernamecheck()' class="form-control">
															<div class="alert alert-danger" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
															 <div class="help-block with-errors" id="emailerror"></div> 
														</div>
													</div>
														<div class="form-group">
														<label class="col-md-3 control-label">Email<span style="color:red">*</span></label>
														<div class="col-md-9">
														
															<input type="text" th:field="*{email}" name="email" id="emailidcheck" onblur='javascript:emailcheck()'  class="form-control">
															<div class="alert alert-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
															<div class="help-block with-errors" id="emailiderror"></div>
														</div>
													</div>
													
													<div class="form-group">
														<label class="col-md-3 control-label">Mobile No<span style="color:red">*</span></label>
														<div class="col-md-1">
															<input type="text" placeholder="+91" class="form-control">
														</div>
														<div class="col-md-8">
														
															<input type="text" th:field="*{mobile_number}"  id="mobilenocheck" onblur='javascript:mobilecheck()'  name="mobile_number" class="form-control">
														    <div class="alert alert-danger" th:if="${#fields.hasErrors('mobile_number')}" th:errors="*{mobile_number}"></div>
															<div class="help-block with-errors" id="mobilenoerror"></div>
														</div>
													</div>
												
													<div class="form-group">
														<label class="col-md-3 control-label">Telephone No<span style="color:red">*</span></label>
														<div class="col-md-1">
															<input type="text" class="form-control">
														</div>
														<div class="col-md-8">
														
															<input type="text" th:field="*{contactno}" name="contactno" class="form-control">
															<div class="alert alert-danger" th:if="${#fields.hasErrors('contactno')}" th:errors="*{contactno}"></div>
														
														</div>
													</div>
													
													<div class="form-group">
													<label class="col-md-3 control-label">Designation<span style="color:red">*</span></label>
													<div class="col-md-9">
													
													<input type="text" th:field="*{designation}" th:value="${designation}"id="designation" name="designation" onblur='javascript:designationcheck()' class="form-control" />
												      <div class="alert alert-danger" th:if="${#fields.hasErrors('designation') }" th:errors="*{designation}"></div>
												      <div class="help-block with-errors" id="designationerror"></div>
												   
													</div>
													</div>
													
													
													<div class="form-group">
														<label class="col-md-3 control-label">Address<span style="color:red">*</span></label>
														<div class="col-md-9">
															<textarea  th:field="*{address}" name="address"  class="form-control"></textarea>
															 <div class="alert alert-danger" th:if="${#fields.hasErrors('address')}" th:errors="*{address}"></div>
														 
														</div>
													</div> 
													
												  <div class="form-group">
														<label class="col-md-3 control-label">Country<span style="color:red">*</span></label>
														   <div class="col-md-9">
														    <div th:if="${Country != null}">
														        <select th:field="*{countryid}" id="ddlcountry" name="countrycode" class="form-control">
														        <option th:value="null" >---Select---</option>
														            <option th:each="dropDownItem : ${Country}"
														               th:value="${dropDownItem.id}"
														               th:text="${dropDownItem.country}" />
														        </select>
														        <div class="alert alert-danger" th:if="${#fields.hasErrors('countryid')}" th:errors="*{countryid}"> </div>
												     	</div>
													   	</div>
														</div> 
						
												<div id="dvState" style="display: none">
											     <div class="form-group">
														<label class="col-md-3 control-label">State<span style="color:red">*</span></label>
														   <div class="col-md-9">
														    <div th:if="${State != null}">
														        <select onchange="GetDistricts();" id="statecode"  th:field="*{stateid}" name="statecode" class="form-control">
														        <option th:value="null" >Select</option>
														            <option th:each="dropDownItem : ${State}"
														               th:value="${dropDownItem.statecode}"
														               th:text="${dropDownItem.statename_inenglish}" />
														        </select>
														       </div>
														       	<div class="alert alert-danger" th:if="${#fields.hasErrors('stateid')}" th:errors="*{stateid}"></div>
														
														   	</div>
														   
														</div> 

														 <div class="form-group">
														<label class="col-md-3 control-label">District<span style="color:red">*</span></label>
														   <div class="col-md-9">
														    <div  th:if="${District != null}">
														        <select id="districtcode" name="districtcode" th:field="*{districtid}" class="form-control">
														        <option th:value="null" >Select</option>
														            <option th:each="dropDownItem : ${District}"
														               th:value="${dropDownItem.districtcode}"
														               th:text="${dropDownItem.districtname_inenglish}" />
														        </select>
														       <div class="alert alert-danger" th:if="${#fields.hasErrors('districtid')}" th:errors="*{districtid}">districtid Error</div>
														   	</div>
														   	
														   	</div>
														</div> 													
													</div>												
														
													<div class="form-group">
														<label class="col-md-3 control-label">City/Town/Village<span style="color:red">*</span></label>
														<div class="col-md-9">
															<input type="text" th:field="*{city}" name="city"  class="form-control">
															 <div class="alert alert-danger" th:if="${#fields.hasErrors('city')}" th:errors="*{city}"></div>
														 
														</div>
													</div>
													
													<div class="form-group">
														<label class="col-md-3 control-label">Pincode/Zipcode<span style="color:red">*</span></label>
														<div class="col-md-9">
															<input type="text" th:field="*{pincode}" name="pincode"  class="form-control">
															 <div class="alert alert-danger" th:if="${#fields.hasErrors('pincode')}" th:errors="*{pincode}"></div>
														 
														</div>
													</div>
													
													<div class="form-group">
														<label class="col-md-3 control-label">Captcha<span style="color:red">*</span></label>
															<div id="captchaBlock">
														        <div id="resource1" class="captchaWrap">  
														            <div class="captcha-input">
													                <input type="hidden" name="enc">
													                <input type="hidden" name="salt">
													                <div class="col-md-5">
													                <input type="text" name="code" class="form-control" placeholder="Enter Captcha">
													                </div>
													                <div class="col-md-2">
													                <div class="c-img">
													                <div class="captchaContainer">
													                </div>
														            </div>
														            </div>
													                <span id="captchaMessage"></span>
													                <input type="hidden" name="redirect" value="/signup">
														            </div>
														            <div class="col-md-1 captcha-refresh-btn" >
														            <div class="refresh-wrap">
														             <span id="searchButton"><i class="fa fa-refresh" aria-hidden="true"></i></span>
														            </div>
														            </div>
															 </div>
															 </div>
															</div>

													<div class="form-group">
														<label class="col-md-3 control-label"></label>
														<div class="col-md-9">
													    <input type="submit" id="btnsubmitcgp" name="submit" class="btn btn-info btn-md" value="Submit" style="background-color:#3e7205;">
														</div>
													</div>
													
													
												</form>
											</div>
										</div>
									</div>
								</div>
							</div>
				</div>
			</div>
	

	<section class="p_40">
	</section>
	
	<div th:replace="fragments/footer.html :: footer"></div>
	<div th:replace="fragments/footerlibs.html :: footerlibs"></div>
	 <script>
	$(document).ready(function() {
			$('[data-toggle="tooltip"]').tooltip();
			if($('#errorModal').length > 0){
				$('#errorModal').modal('show');
			}
		});
							  
	    $( document ).ready(function() {
	        getCaptcha();
	         validateCaptcha();
	        $("#searchButton").click(function(){
	            console.log('inside call');
	            getCaptcha();
	        });
	
	    });
	
	    function getCaptcha(){
	        var html = "<h2>Loading Captcha</h2>"
	        console.log("/bin/captcha");
	        var url = "/bin/captcha"; 
	
	        console.log(url);
	
	        $.ajax({
	            url: url, 
	            type: 'get',
												 
							   
	            success: function (result) {
	                html = "";
	                var captchaImg = "", captcha="",salt="";
	                if(result !== undefined || result !== null){
	                    captchaImg  = result.image;
	                    captcha = result.captcha;
	                    salt = result.salt;
	                     $('#resource1').find('.captchaContainer').html("<img id='captchaImage' src='data:image/png;base64,"+ captchaImg+"'></img>");
	
	                    $('#resource1').find('[name="enc"]').val(captcha);
	                    $('#resource1').find('[name="salt"]').val(salt);
	                }
	
	
	            },
	            error: function() {
	                console.log("Error while creating captcha");
	            }
	        });
	
	
	    }
	   
	   function validateCaptcha() {
	        var isValid = false;
	        $('#register-form').find('[type="submit"]').on('click', function(event) {
	            if(event.hasOwnProperty('originalEvent')){
	            $('#captchaMessage').html("");
	            event.preventDefault();
	                if($("[name='code']").val() != ""){
	                var salt = $('[name="salt"]').val();
	                var code = $('[name="code"]').val();
	                var enc = $('[name="enc"]').val();
	
	                $.ajax({
	                    url: '/bin/validateCaptcha',
	                    type: 'post',
	                    data: $('#register-form').find('[name="salt"], [name="code"], [name="enc"], [name="${_csrf.parameterName}"]').serialize(),    
	                    success: function(data){
	                        console.log("Inside success");
	                        console.log(data.valid);
	                        if(!data.valid){
	                            $("#captchaMessage").html("You entered wrong captcha code, please enter again");
	                            return false;
	
	                        }
	                        else{
	                            console.log("now submit");
	                            isValid = true;
	                            //$('#' + "${formId}").submit();
	                              $('#register-form').find('[type="submit"]').trigger('click');
	                        }
	                        return false;
	                    },
	                    error: function() {
	                        console.log("An error occured while validating captcha");
	                    },
	                    complete: function(){
	                        console.log("ajax completed ");
	                    }
	                });
	
	            }
	
	            else{
	
	                $("#captchaMessage").html("Please enter captcha code");
	
	                return false;
	            }
	        }
	        });
	
	       return false;							  
	    }
	</script>
<script type="text/javascript">
   function GetDistricts()
  {
       var ddlState= document.getElementById("statecode");
       var district=document.getElementById("districtcode");
       var district1=$("#districtcode");
       if(ddlState.value != null)	
       	$.ajax({
               type: "POST",
               url: "/ppvfra/getDistricts",
               data: 'stateCode='+ddlState.value,
               dataType:"json",
               success: function (response) {
               	
              district1.empty().append('<option selected="selected" value="">Please select</option>');
                for(var k=0;k<response.length;k++)
     	  {
     	  var opt = response[k];
     	   var el = document.createElement("option");
     	   el.textContent = opt[1];
     	   el.value = opt[0];
     	   district.appendChild(el);
																	 
     	}
 
 
               },
               failure: function (response) {
                   alert(response.responseText);
					  
               },
               error: function (response) {
                   alert(response.responseText);
					   
										  
														
               }
      });
   	
   }
 </script>		
    <script type="text/javascript">
    $(function () {
        $("#ddlapplicant").change(function () {
            if ($(this).val() == "2") {
                $("#dvCompany").show();
            } else {
                $("#dvCompany").hide();
            }
            if ($(this).val() == "3") {
                $("#dvInstitution").show();
            } else {
                $("#dvInstitution").hide();
            }
            if ($(this).val() == "5") {
                $("#dvOther").show();
            } else {
                $("#dvOther").hide();
            }
        });
        
    });
</script>	
 <script type="text/javascript">
    $(function () {
        $("#ddlcountry").change(function () {
            if ($(this).val() == "1") {
                $("#dvState").show();
            } else {
                $("#dvState").hide();
            }
           
        });
        
    });
</script>	
<script>
function myFunction() {
  var inpObj = document.getElementById("designation");
  if (!inpObj.checkValidity()) {
    document.getElementById("designationerror").innerHTML = inpObj.validationMessage;
  } else {
    document.getElementById("designationerror").innerHTML = "Fill designation";
  } 
} 
</script>

<script type="text/javascript">
        function emailcheck() {
            var emailid =document.getElementById("emailidcheck").value;
          // alert(emailid);
            $.ajax({
                type: "POST",
                url: "/ppvfra/checkmail",
                data:emailid,
                contentType:'application/json',
                success: function (data) {
                 
                if(data == 'taken')
				{
                //Email not available.
        		document.getElementById("emailiderror").innerHTML = " <font color='red'>Email is already present.</font>";
        		document.forms["register-form"]["emailidcheck"].focus();
        		return false;
                }
				else if (data == 'not taken') 
				{
				document.getElementById("emailiderror").innerHTML = " ";
			     return true;
                    }
                   
                }
            }); 
  }
        </script>
        <script type="text/javascript">
        function mobilecheck() {
            var emailid =document.getElementById("mobilenocheck").value;
            //alert(emailid);
            $.ajax({
                type: "POST",
                url: "/ppvfra/checkmobile",
                data:emailid,
                contentType:'application/json',
                success: function (data) {
                 
                if(data == 'taken')
				{
                //Email not available.
        		document.getElementById("mobilenoerror").innerHTML = " <font color='red'>Mobile Number is already present.</font>";
        		document.forms["register-form"]["mobilenocheck"].focus();
        		return false;
                }
				else if (data == 'not taken') 
				{
				document.getElementById("mobilenoerror").innerHTML = " ";
			     return true;
                    }
                   
                }
            }); 
  }
    </script>
    	<script type="text/javascript">
        function usernamecheck() {
        	var letter = /^[a-zA-Z0-9]+$/;
            var emailid =document.getElementById("username").value;
          // alert(emailid);
            $.ajax({
                type: "POST",
                url: "/ppvfra/checkusername",
                data:emailid,
                contentType:'application/json',
                success: function (data) {
                 
                if(data == 'taken')
				{
                //Email not available.
        		document.getElementById("emailerror").innerHTML = " <font color='red'>Username is already present.</font>";
        		document.forms["register-form"]["username"].focus();
        		return false;
                }
				else if (data == 'not taken') 
				{

					if(isNaN(emailid))
	    			{
						if(letter.test(emailid))
						{
							document.getElementById("emailerror").innerHTML = " ";
							return true;  
						} 
						else
						{
							document.getElementById("emailerror").innerHTML = " <font color='red'>Special characters are not allowed.</font>";
							document.forms["register-form"]["username"].focus();
			        		return false;  
						}
	    			}
					else
					{
						document.getElementById("emailerror").innerHTML = " <font color='red'>Username cannot be fully numeric.</font>";
						document.forms["register-form"]["username"].focus();
		        		return false;  
					}
				
			     
                    }
                   
                }
            }); 
  }
    </script>
    
<script type="text/javascript">
        function institutenamecheck() {
        	var letter = /^[a-zA-Z ]*$/;
            var name =document.getElementById("other").value;
            $.ajax({
                type: "POST",
                url: "/ppvfra/checkinstitute",
                data:name,
                contentType:'application/json',
                success: function (data) {
                if(data == 'taken')
				{
	                document.getElementById("othererror").innerHTML = " <font color='red'>Institute Name already present.</font>";
	        		document.forms["register-form"]["other"].focus();
	        		return false;
                }
				else if (data == 'not taken') 
				{
					if(isNaN(name))
	    			{
						if(letter.test(name))
						{
							document.getElementById("othererror").innerHTML = " ";
							return true;  
						}
					else
            	     {
						document.getElementById("othererror").innerHTML = " <font color='red'>Special characters are not allowed.</font>";
		        		document.forms["register-form"]["other"].focus();
		        		return false;  
            	     } 
	    			}
					else
					{
						document.getElementById("othererror").innerHTML = " <font color='red'>Institute Name cannot be fully numeric.</font>";
						document.forms["register-form"]["other"].focus();
		        		return false;  
					}
			     	
			     	
                }
                   
                }
            }); 
  }
    </script>
  <script type="text/javascript">
        function companycheck() {
        	var letter = /^[a-zA-Z ]*$/;
            var emailid =document.getElementById("other").value;
            //alert(emailid);
            $.ajax({
                type: "POST",
                url: "/ppvfra/company",
                data:emailid,
                contentType:'application/json',
                success: function (data) {
                 
                if(data == 'taken')
				{
                //Email not available.
        		document.getElementById("othererror").innerHTML = " <font color='red'>Company Name already exists.</font>";
        		document.forms["register-form"]["other"].focus();
        		return false;
                }
				else if (data == 'not taken') 
				{
					if(isNaN(emailid))
	    			{
						if(letter.test(emailid))
						{
							document.getElementById("othererror").innerHTML = " ";
							return true;  
						}
					else
            	     {
						document.getElementById("othererror").innerHTML = " <font color='red'>Special characters are not allowed.</font>";
						document.forms["register-form"]["other"].focus();
		        		return false;  
            	     } 
	    			}
					else
					{
						document.getElementById("othererror").innerHTML = " <font color='red'>Company Name cannot be fully numeric.</font>";
						document.forms["register-form"]["other"].focus();
		        		return false;  
					}
			    
                    }
                   
                }
            }); 
  }
    </script>
    
    <script type="text/javascript">
        function designationcheck() {
            var emailid =document.getElementById("designation").value;
            var letters = /^[ A-Za-z_@./#&+-]*$/;
				 var format = /^[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/;
				 if(format.test(emailid)){
					 document.getElementById("designationerror").innerHTML = " <font color='red'>Special characters and numbers are not allowed.</font>";
					 document.forms["register-form"]["designation"].focus();
		        	 return false;  
					 
				 }else if(letters.test(emailid))
            	     {
            		   document.getElementById("designationerror").innerHTML = " ";
					   return true;
            	     }
            	   else
            	     {
            		   document.getElementById("designationerror").innerHTML = " <font color='red'>Special characters and numbers are not allowed.</font>";
            		   document.forms["register-form"]["designation"].focus();
		        	   return false;  
            	     }
            	}
</script>
<script type="text/javascript">
        function authornamecheck() {
            var emailid =document.getElementById("authorname").value;
            var letters = /^[a-zA-Z ]*$/;
				
				  if(letters.test(emailid))
            	     {
            		   document.getElementById("authornameerror").innerHTML = " ";
            		   return true;
            	     }
            	   else
            	     {
            		   document.getElementById("authornameerror").innerHTML = " <font color='red'>Applicant name in special characters or in numeric format is not accepted.</font>";
            		   document.forms["register-form"]["authorname"].focus();
            		   
		        		return false;  
            	     }
            	}
</script>
   
</body>
</html>